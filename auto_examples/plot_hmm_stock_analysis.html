<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Gaussian HMM of stock data &mdash; hmmlearn 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/copybutton.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="hmmlearn 0.1.0 documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="../index.html">hmmlearn 0.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="gaussian-hmm-of-stock-data">
<span id="example-plot-hmm-stock-analysis-py"></span><h1>Gaussian HMM of stock data<a class="headerlink" href="#gaussian-hmm-of-stock-data" title="Permalink to this headline">Â¶</a></h1>
<p>This script shows how to use Gaussian HMM.
It uses stock price data, which can be obtained from yahoo finance.
For more information on how to get stock prices with matplotlib, please refer
to date_demo1.py of matplotlib.</p>
<img alt="../_images/plot_hmm_stock_analysis_001.png" class="align-center" src="../_images/plot_hmm_stock_analysis_001.png" />
<p><strong>Script output</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre>fitting to HMM and decoding ...done

Transition matrix
[[  7.19570896e-01   1.54624945e-01   1.18353870e-01   3.91487480e-03
    3.53541433e-03]
 [  1.49256768e-01   8.20683060e-01   2.91920321e-02   8.56509234e-04
    1.16305658e-05]
 [  3.15863454e-01   3.27728996e-02   6.27311548e-01   3.88995961e-15
    2.40520979e-02]
 [  9.57321054e-09   2.40272141e-03   1.10020777e-16   9.76774787e-01
    2.08224821e-02]
 [  1.10331551e-16   3.62797664e-18   3.24873826e-01   2.62793721e-01
    4.12332453e-01]]

means and vars of each hidden state
0th hidden state
mean =  [  1.08390044e-02   6.99254267e+07]
var =  [  1.08104002e-01   1.53019839e+14]

1th hidden state
mean =  [  5.99449776e-03   4.91243373e+07]
var =  [  4.40560058e-02   1.09682763e+14]

2th hidden state
mean =  [  3.47721620e-02   1.10484034e+08]
var =  [  1.71578756e-01   8.81855827e+14]

3th hidden state
mean =  [  2.59388740e-02   4.96953798e+07]
var =  [  7.73764164e-01   2.50605712e+14]

4th hidden state
mean =  [ -7.22680912e-01   1.49417678e+08]
var =  [  5.36451260e+00   1.02704097e+16]
</pre></div>
</div>
<p><strong>Python source code:</strong> <a class="reference download internal" href="../_downloads/plot_hmm_stock_analysis.py"><tt class="xref download docutils literal"><span class="pre">plot_hmm_stock_analysis.py</span></tt></a></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">pl</span>
<span class="kn">from</span> <span class="nn">matplotlib.finance</span> <span class="kn">import</span> <a href="http://matplotlib.org/api/finance_api.html#matplotlib.finance.quotes_historical_yahoo"><span class="n">quotes_historical_yahoo</span></a>
<span class="kn">from</span> <span class="nn">matplotlib.dates</span> <span class="kn">import</span> <a href="http://matplotlib.org/api/dates_api.html#matplotlib.dates.YearLocator"><span class="n">YearLocator</span></a><span class="p">,</span> <a href="http://matplotlib.org/api/dates_api.html#matplotlib.dates.MonthLocator"><span class="n">MonthLocator</span></a><span class="p">,</span> <a href="http://matplotlib.org/api/dates_api.html#matplotlib.dates.DateFormatter"><span class="n">DateFormatter</span></a>
<span class="kn">from</span> <span class="nn">hmmlearn.hmm</span> <span class="kn">import</span> <span class="n">GaussianHMM</span>


<span class="k">print</span><span class="p">(</span><span class="n">__doc__</span><span class="p">)</span>

<span class="c">###############################################################################</span>
<span class="c"># Downloading the data</span>
<span class="n">date1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1995</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c"># start date</span>
<span class="n">date2</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>  <span class="c"># end date</span>
<span class="c"># get quotes from yahoo finance</span>
<span class="n">quotes</span> <span class="o">=</span> <a href="http://matplotlib.org/api/finance_api.html#matplotlib.finance.quotes_historical_yahoo"><span class="n">quotes_historical_yahoo</span></a><span class="p">(</span><span class="s">&quot;INTC&quot;</span><span class="p">,</span> <span class="n">date1</span><span class="p">,</span> <span class="n">date2</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">quotes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span>

<span class="c"># unpack quotes</span>
<span class="n">dates</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.array.html#numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quotes</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">close_v</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.array.html#numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quotes</span><span class="p">])</span>
<span class="n">volume</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.array.html#numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quotes</span><span class="p">])[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c"># take diff of close value</span>
<span class="c"># this makes len(diff) = len(close_t) - 1</span>
<span class="c"># therefore, others quantity also need to be shifted</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">close_v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">close_v</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">close_v</span> <span class="o">=</span> <span class="n">close_v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c"># pack diff and volume for training</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">diff</span><span class="p">,</span> <span class="n">volume</span><span class="p">])</span>

<span class="c">###############################################################################</span>
<span class="c"># Run Gaussian HMM</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;fitting to HMM and decoding ...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
<span class="n">n_components</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c"># make an HMM instance and execute fit</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">GaussianHMM</span><span class="p">(</span><span class="n">n_components</span><span class="p">,</span> <span class="n">covariance_type</span><span class="o">=</span><span class="s">&quot;diag&quot;</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">([</span><span class="n">X</span><span class="p">])</span>

<span class="c"># predict the optimal sequence of internal hidden state</span>
<span class="n">hidden_states</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;done</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

<span class="c">###############################################################################</span>
<span class="c"># print trained parameters and plot</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Transition matrix&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">transmat_</span><span class="p">)</span>
<span class="k">print</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;means and vars of each hidden state&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_components</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">th hidden state&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;mean = &quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">means_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;var = &quot;</span><span class="p">,</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.diag.html#numpy.diag"><span class="n">np</span><span class="o">.</span><span class="n">diag</span></a><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">covars_</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">print</span><span class="p">()</span>

<span class="n">years</span> <span class="o">=</span> <a href="http://matplotlib.org/api/dates_api.html#matplotlib.dates.YearLocator"><span class="n">YearLocator</span></a><span class="p">()</span>   <span class="c"># every year</span>
<span class="n">months</span> <span class="o">=</span> <a href="http://matplotlib.org/api/dates_api.html#matplotlib.dates.MonthLocator"><span class="n">MonthLocator</span></a><span class="p">()</span>  <span class="c"># every month</span>
<span class="n">yearsFmt</span> <span class="o">=</span> <a href="http://matplotlib.org/api/dates_api.html#matplotlib.dates.DateFormatter"><span class="n">DateFormatter</span></a><span class="p">(</span><span class="s">&#39;%Y&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_components</span><span class="p">):</span>
    <span class="c"># use fancy indexing to plot data in each state</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">hidden_states</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot_date</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">close_v</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">th hidden state&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c"># format the ticks</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">years</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">yearsFmt</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">months</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">()</span>

<span class="c"># format the coords message box</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fmt_xdata</span> <span class="o">=</span> <a href="http://matplotlib.org/api/dates_api.html#matplotlib.dates.DateFormatter"><span class="n">DateFormatter</span></a><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fmt_ydata</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">&#39;$</span><span class="si">%1.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">x</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>
<span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Total running time of the example:</strong>  3.60 seconds
( 0 minutes  3.60 seconds)</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/auto_examples/plot_hmm_stock_analysis.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="../index.html">hmmlearn 0.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010 - 2015, hmmlearn developers (BSD License).
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>